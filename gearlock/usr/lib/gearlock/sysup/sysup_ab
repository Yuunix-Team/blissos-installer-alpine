#!/bin/bash

die() { echo "$*" >&2 && exit 1; }

NEWIMG=$1
shift

"$GEARLIB"/checkfree "$(du -sk "$NEWIMG" | awk '{print $1}')" ||
	die "Not enough space to update system image" 1

[ "$SYSTEM_TYPE" != dir ] && COMP=.$SYSTEM_TYPE

other() { THE_OTHER=$SRCDIR/system_$1$COMP; }

echo "$SYSTEM" | grep -qE '_a(\.(img|[se]fs))?$' && other b || other a

[ -e "$THE_OTHER" ] && rm -rf "$THE_OTHER"

mv "$NEWIMG" "$THE_OTHER"
